<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inventory Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background-color: #f5f5f7; }
    .chat-bubble { max-width: 80%; border-radius: 12px; padding: 12px 16px; }
    .user-bubble { background-color: #007aff; color: white; margin-left: auto; border-bottom-right-radius: 4px; }
    .bot-bubble { background-color: #e5e5ea; color: #1c1c1e; border-bottom-left-radius: 4px; }
  </style>
</head>
<body class="flex flex-col h-screen">
  <!-- Chat Area -->
  <div class="flex-1 p-6 overflow-y-auto">
    <div class="max-w-3xl mx-auto space-y-4" id="chatContainer">
      <div class="flex justify-start">
        <div class="chat-bubble bot-bubble">
          <p>Hello! I'm your Inventory Assistant.</p>
          <p class="mt-2">Try commands like:</p>
          <ul class="list-disc pl-5 mt-1">
            <li>Add 10 iPhones</li>
            <li>Remove 5 MacBooks</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="p-4 border-t border-gray-200">
    <div class="max-w-3xl mx-auto flex">
      <input type="text" id="userInput" class="flex-1 px-4 py-3 border border-gray-200 rounded-l-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500" placeholder="Type inventory command..." />
      <button id="sendBtn" class="bg-blue-500 text-white px-6 rounded-r-lg hover:bg-blue-600">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <script>
    const chatContainer = document.getElementById("chatContainer");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    const webhookURL = "https://script.google.com/macros/s/AKfycbwulNPeT8TDWo6v6LbLdhudb0Fb3p979ZYNIBEJpG-BL-adwgq7TMyHg0YUfS7tLh8s/exec";

    function addMessage(text, isUser = false) {
      const msgDiv = document.createElement("div");
      msgDiv.className = "flex justify-" + (isUser ? "end" : "start");

      const bubble = document.createElement("div");
      bubble.className = `chat-bubble ${isUser ? "user-bubble" : "bot-bubble"}`;
      bubble.innerText = text;

      msgDiv.appendChild(bubble);
      chatContainer.appendChild(msgDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function processCommand(cmd) {
      addMessage(cmd, true);
      const addMatch = /add (\d+)\s+(.+)/i;
      const remMatch = /remove (\d+)\s+(.+)/i;

      let command = "", item = "", quantity = 0;

      if (addMatch.test(cmd)) {
        [, quantity, item] = cmd.match(addMatch);
        command = "add";
      } else if (remMatch.test(cmd)) {
        [, quantity, item] = cmd.match(remMatch);
        command = "remove";
      } else {
        addMessage("❌ Invalid command. Try: Add 5 Chips", false);
        return;
      }

      try {
        const res = await fetch(webhookURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ command, item, quantity: parseInt(quantity) })
        });

        const text = await res.text();
        if (res.ok) {
          addMessage(`✅ ${text}`, false);
        } else {
          addMessage("❌ Failed: " + text, false);
        }
      } catch (err) {
        console.error(err);
        addMessage("❌ Error: " + err.message, false);
      }
    }

    sendBtn.addEventListener("click", () => {
      const msg = userInput.value.trim();
      if (msg) {
        processCommand(msg);
        userInput.value = "";
      }
    });

    userInput.addEventListener("keypress", e => {
      if (e.key === "Enter") sendBtn.click();
    });
  </script>
</body>
</html>
